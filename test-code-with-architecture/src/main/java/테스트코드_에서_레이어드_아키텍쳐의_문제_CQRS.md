# 레이어드 아키텍쳐에서의 문제점
레이어드 아키텍쳐를 사용한 테스트코드 작성에는 mockito나 h2 같은 기술이 필요로 해진다.  
mockito, h2를 사용할 수 없는 elasticsearch 나 이런 것들을 프로젝트에 적용하면  테스트가 불가능한 상태가 되어버린다.

- h2 : 모든 테스트가 h2를 사용하고 h2를 사용하는 순간, 이 테스트들은 모두 중형 테스트가 된다.
    - 설계가 잘못되었을 확률이 있다
    - 지금 작성한 테스트가 실제로 테스트가 필요한 본질이 아닐 확률이 높다.


레이어드 아키텍처는 접근성이 좋아서 처음 개발을 배우거나 여러 서적에서 찾아볼 수 있다.   
하지만 레이어드 아키텍처는 여러가지 문제점이 있다.
1. DB 주도 설계
    - 어떤 시스템을 설계할때 JPA Entity 혹은 DB 구조를 먼저 설계할게 아니라 Use case를 먼저 파악해야 한다  
2. 동시 작업
    - 모든 것이 영속성 계층 위에 만들어지기 때문에 영속성 계층을 먼저 개발해야 하고, 그 다음에 도메인 계층을, 그리고 마지막으로 웹 계층을 만들게 된다. 그렇기 때문에 특정 기능은 동시에 한 명의 개발자만 작업할 수 있다.
3. 죽은 도메인
    - 계층형 아키텍처는 업무 도메인에 대해 아무것도 말해주지 않는다 -> 객체는 수동적이고 모든 코드가 함수 위주로 돌아간다.

이러한 단점들 때문에 개발자는 절차지향적으로 생각하게 되고, 낮은 Testability와 SOLID를 안지키며 개발하게 되는 문제가 발생된다.


### CQRS (Command and Query Responsibility Segregation)?
명령과 질의의 책임 분리 -> 메서드를 명령과 질의로 나누자 (더 넓게는 클래스까지도.)  
하나의 메서드는 명령이나 쿼리여야하며, 두 가지 기능을 모두 가져서는 안된다. 명령은 객체의 상태를 변경할 수 있지만, 값을 반환하지 않는다.  
쿼리는 값을 반환하지만 객체를 변경하지 않는다.

- 명령 : 상태를 바꾸는 메서드
  - 명령 메서드는 void 타입이어야 한다.
  - 편의상 명령 메서드가 종종 return this 하는 경우도 있는데, 잘못된 방법이다.
- 질의 : 상태를 물어보는 메서드
  - 질의 메서드는 상태를 변경해서는 안된다.
  
Repository대신 Reader / Writer   

| Repository | Object        | Type            |
|------------|---------------|-----------------|
| UserReader | UserReaderonly | VO              |
| UserWriter | UserEditable  | Editable object |